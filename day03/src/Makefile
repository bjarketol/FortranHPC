#------------------------------------------------------------------------------
# Simple Makefile for this exercise
# Author: Bjarke Tobias Olsen
# Created: 6. january 2016
#------------------------------------------------------------------------------
SHELL       = /bin/sh
TARGET      = run.exe
BIN         = run.exe

#------------------------------------------------------------------------------
# COMPILER SETTINGS (Linux)
#------------------------------------------------------------------------------
FC          = gfortran
FFLAGS      = -Wall -fcheck=all
LD          = $(FC)
LDFLAGS     = 
LIBS        = 
#------------------------------------------------------------------------------
# BINARY DIRECTORY
#------------------------------------------------------------------------------
bindir      = /home/btol/Dropbox/HPC/code/day3/bin

#------------------------------------------------------------------------------
# DEFAULT TARGET
#------------------------------------------------------------------------------
all: $(TARGET)

#------------------------------------------------------------------------------
# OBJECT FILES (OBS: Make sure no file depends on anything below it)
#------------------------------------------------------------------------------
OBJS = master.o \
	   init.o \
       take_step.o \
       write_out.o \
       copy.o \
       alloc.o \
       main.o

#------------------------------------------------------------------------------
# DEPENDENCIES
#------------------------------------------------------------------------------
main.o: main.f95 alloc.f95 copy.f95 write_out.f95 take_step.f95 init.f95 master.f95
	$(FC) $(FFLAGS) -c main.f95
copy.o: copy.f95 master.f95
	$(FC) $(FFLAGS) -c copy.f95
write_out.o: write_out.f95 master.f95
	$(FC) $(FFLAGS) -c write_out.f95
take_step.o: take_step.f95 master.f95
	$(FC) $(FFLAGS) -c take_step.f95
init.o: init.f95 master.f95
	$(FC) $(FFLAGS) -c init.f95
master.o: master.f95
	$(FC) $(FFLAGS) -c master.f95
alloc.o: alloc.f95
	$(FC) $(FFLAGS) -c alloc.f95

#------------------------------------------------------------------------------
# LINK
#------------------------------------------------------------------------------
$(TARGET): $(OBJS)
	$(LD) -o $(BIN) $(LDFLAGS) $(OBJS) $(LIBS)

#------------------------------------------------------------------------------
# INSTALL
#------------------------------------------------------------------------------
install: $(BIN)
	(cp -f $(BIN) $(bindir))

#------------------------------------------------------------------------------
# RUN
#------------------------------------------------------------------------------
run: $(BIN)
	$(BIN)

#------------------------------------------------------------------------------
# CLEAN
#------------------------------------------------------------------------------
clean:
	rm *.exe
	rm *.o
	rm *.mod
	rm $(bindir)/run.exe



